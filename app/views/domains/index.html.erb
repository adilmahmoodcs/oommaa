<h3>
  <%= t(@status || :all) %>
  Domains
  (<%= @domains.total_count %>)
</h3>

<div class="card">
  <div class="card-block">
    <%= form_for Domain.new, html: { class: "form-inline" } do |f| %>
      <%= f.hidden_field :status, value: @status if @status %>
      <%= f.text_field :name,
                       class: "form-control fast-add-form mb-2 mr-sm-2 mb-sm-0",
                       placeholder: "Name" %>
      <% if @status == "blacklisted" %>
        <%= f.email_field :owner_email,
                         class: "form-control fast-add-form mb-2 mr-sm-2 mb-sm-0",
                         placeholder: "Owner's Email" %>
      <% end %>
      <%= f.button class: "btn btn-primary" do %>
        <%= icon("plus") %>
        Add New
      <% end %>
    <% end %>
  </div>
</div>

<br>

<table class="table table-hover table-bordered domains-table" id="scroll_table">
  <thead>
    <tr>
      <th><%= sort_link(@q, :name_case_insensitive, "Name") %></th>
      <% if @status == "blacklisted"%>
        <th><%= sort_link(@q, :owner_email, "Owner's Email") %></th>
      <% end %>
      <th>Actions</th>
    </tr>
  </thead>

  <tbody class="scroll_table_body">
    <% @domains.each do |domain| %>
      <tr class="scroll_table_data">
        <td>
          <%= link_to domain.name, "http://#{domain.name}", target: "_blank"  %>
        </td>
        <% if @status == "blacklisted"%>
          <td class="affiliate_page_name">
            <span> <%= domain.owner_email %> </span>
            <% if policy(Domain).update? %>
              <%= form_for domain, html:{class: "#{!domain.owner_email ? 'show' : 'hide'}"} do |d| %>
                <div class="row">
                  <div class="col-sm-8">
                    <%= d.email_field :owner_email, required: true,
                             class: "form-control fast-add-form mb-2 mr-sm-2 mb-sm-0",
                             placeholder: "Owner's Email" %>
                  </div>
                  <div class="col-sm-4">
                    <%= d.button class: "btn btn-primary btn-sm pull-right" do %>
                      <%= icon("plus") %>
                      Edit
                    <% end %>
                  </div>
                </div>
              <% end %>
              <%= button_tag class: "btn btn-primary btn-sm pull-right update_name_btn #{domain.owner_email ? 'show' : 'hide' }" do %>
                <%= icon("edit") %>
                Edit
              <% end %>
              &nbsp;
            <% end %>
          </td>
        <% end %>
        <td class="text-right">
          <% unless domain.whitelisted? %>
            <%= link_to domain_change_status_path(domain, :whitelisted),
                        method: :post,
                        class: "btn btn-success btn-sm" do %>
              <%= icon("check") %>
              Move to Whitelist
            <% end %>
          <% end %>

          <% unless domain.blacklisted? %>
            <%= link_to domain_change_status_path(domain, :blacklisted),
                        method: :post,
                        class: "btn btn-danger btn-sm" do %>
              <%= icon("ban") %>
              Move to Blacklist
            <% end %>
          <% end %>

          <%= link_to domain,
                      method: :delete,
                      data: { confirm: 'Are you sure?' },
                      class: "btn btn-danger btn-sm" do %>
            <%= icon("trash") %>
            Delete
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<div class="hide">
  <%= paginate @domains %>
</div>
