<div class="row">
  <div class="col-md-8">
    <h3>
      Blacklisted ads export
    </h3>
  </div>
  <div class="col-md-4 text-right">
    <%= link_to url_for(from: params[:from], to: params[:to], format: :csv),
                class: "btn btn-primary" do %>
      <%= icon("download") %>
      <%= t(:download_as_csv) %>
    <% end %>
  </div>
</div>

<strong>
  <% if params[:from].present? %>
    From
    <%= l(Date.parse(params[:from]), format: :compact) %>
  <% end %>
  <% if params[:to].present? %>
    to
    <%= l(Date.parse(params[:to]), format: :compact) %>
  <% end %>
  <% if !params[:from].present? && !params[:to].present? %>
    All time
  <% end %>
  (<%= @posts.total_count %> posts)
</strong>
<hr>

<%= form_tag export_facebook_posts_path, method: :get, class: "form-inline", id: "export-date" do %>
  <%= label_tag :from, "From date:", class: "col-form-label mb-2 mr-sm-2 mb-sm-0" %>
  <%= date_field_tag :from, params[:from], class: "form-control mb-2 mr-sm-2 mb-sm-0" %>

  <%= label_tag :from , "To date:", class: "col-form-label mb-2 mr-sm-2 mb-sm-0" %>
  <%= date_field_tag :to, params[:to], class: "form-control mb-2 mr-sm-2 mb-sm-0" %>

  <%= button_tag class: "btn btn-primary" do %>
    <%= icon("filter") %>
    Filter
  <% end %>
<% end %>

<hr>

<%= paginate @posts %>

<table class="table table-hover table-bordered">
  <thead>
    <tr>
      <th><%= sort_link(@q, :published_at, t(:published_at)) %></th>
      <th><%= sort_link(@q, :blacklisted_at, t(:blacklisted_at)) %></th>
      <th><%= sort_link(@q, :blacklisted_by, t(:blacklisted_by)) %></th>
      <th><%= sort_link(@q, :reported_to_facebook_at, t(:reported_to_facebook_at)) %></th>
      <th><%= sort_link(@q, :reported_to_facebook_by, t(:reported_to_facebook_by)) %></th>
      <th><%= sort_link(@q, :facebook_page_brands_name, t(:brand_name)) %></th>
      <th><%= sort_link(@q, :facebook_page_brands_licensor_name, t(:licensor_name)) %></th>
      <th><%= sort_link(@q, :all_domains, t(:platform_or_company)) %></th>
      <th><%= sort_link(@q, :facebook_page_name, t(:facebook_page_name)) %></th>
      <th><%= t(:message) %></th>
      <th><%= t(:link_to_product) %></th>
      <th><%= t(:link_to_ad_screenshot) %></th>
      <th><%= t(:link_to_product_screenshot) %></th>
    </tr>
  </thead>

  <tbody>
    <% @posts.each do |post| %>
      <tr>
        <td>
          <%= l(post.published_at, format: :compact) %>
        </td>
        <td>
          <%= l(post.blacklisted_at, format: :compact) if post.blacklisted_at %>
        </td>
        <td>
          <%= post.blacklisted_by %>
        </td>
        <td>
          <%= l(post.reported_to_facebook_at, format: :compact) if post.reported_to_facebook_at %>
        </td>
        <td>
          <%= post.reported_to_facebook_by %>
        </td>
        <td>
          <%= post.brand_names %>
        </td>
        <td>
          <%= post.licensor_names %>
        </td>
        <td>
          <%= post.all_domains.join(", ") %>
        </td>
        <td>
          <%= link_to post.facebook_page.name, post.facebook_page.url, target: "_blank" %>
        </td>
        <td>
          <%= link_to truncate(post.message, length: 20), post.permalink, target: "_blank" %>
        </td>
        <td>
          <%= link_to "Link", post.all_links.last, target: "_blank" %>
        </td>
        <td>
          <%= ad_screenshot_links(post) %>
        </td>
        <td>
          <%= product_screenshot_links(post) %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<%= paginate @posts %>
